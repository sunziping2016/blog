self.addEventListener('message', (event) => {
    if (event.data && event.data.type === 'SKIP_WAITING') {
      self.skipWaiting()
    }
  })

  self.addEventListener('activate', (event) => {
    self.registration.unregister()
      .then(function () {
        return self.clients.matchAll()
      })
      .then(function (clients) {
        clients.forEach(client => client.navigate(client.url))
      })
  })

  self.addEventListener('message', event => {
    const replyPort = event.ports[0]
    const message = event.data
    if (replyPort && message && message.type === 'skip-waiting') {
      event.waitUntil(
        self.skipWaiting().then(
          () => replyPort.postMessage({ error: null }),
          error => replyPort.postMessage({ error })
        )
      )
    }
  })
